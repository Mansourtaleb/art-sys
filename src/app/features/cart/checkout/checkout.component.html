<app-navbar></app-navbar>

<main class="py-5">
  <div class="container">
    <h1 class="mb-4">
      <i class="bi bi-credit-card"></i> Finaliser la commande
    </h1>

    <div class="row">
      <!-- Formulaire -->
      <div class="col-lg-8">
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0">Adresse de livraison</h5>
          </div>
          <div class="card-body">
            <form #checkoutForm="ngForm">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Nom complet *</label>
                  <input
                    type="text"
                    class="form-control"
                    [(ngModel)]="adresse().nom"
                    name="nom"
                    required
                  >
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Téléphone *</label>
                  <input
                    type="tel"
                    class="form-control"
                    [(ngModel)]="adresse().telephone"
                    name="telephone"
                    required
                  >
                </div>

                <label class="form-label">Adresse *</label>
                <input
                  type="text"
                  class="form-control"
                  [(ngModel)]="adresse().adresse"
                  name="adresse"
                  required
                >
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Ville *</label>
                  <input
                    type="text"
                    class="form-control"
                    [(ngModel)]="adresse().ville"
                    name="ville"
                    required
                  >
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Code postal *</label>
                  <input
                    type="text"
                    class="form-control"
                    [(ngModel)]="adresse().codePostal"
                    name="codePostal"
                    required
                  >
                </div>

                <div class="col-12 mb-3">
                  <label class="form-label">Pays *</label>
                  <input
                    type="text"
                    class="form-control"
                    [(ngModel)]="adresse().pays"
                    name="pays"
                    value="Tunisie"
                    readonly
                  >
                </div>
            </form>
          </div>
        </div>

        @if (error()) {
          <div class="alert alert-danger">
            <i class="bi bi-exclamation-triangle"></i> {{ error() }}
          </div>
        }
      </div>

      <!-- Résumé - COL-LG-4 AJOUTÉ -->
      <div class="col-lg-4">
        <div class="card mb-4">
          <div class="card-body">
            <h5 class="card-title mb-3">Récapitulatif de la commande</h5>

            @for (item of items(); track item.oeuvreId) {
              <div class="d-flex justify-content-between align-items-center mb-2">
                <div>
                  <div>{{ item.titre }}</div>
                  <small class="text-muted">Qté: {{ item.quantite }}</small>
                </div>
                <strong>{{ item.prix * item.quantite }} DT</strong>
              </div>
            }

            <hr>

            <div class="d-flex justify-content-between mb-2">
              <span>Sous-total</span>
              <strong>{{ total() }} DT</strong>
            </div>

            <div class="d-flex justify-content-between mb-2">
              <span>Livraison</span>
              <strong>Gratuit</strong>
            </div>

            <hr>

            <div class="d-flex justify-content-between mb-3">
              <h5>Total</h5>
              <h5 class="text-primary">{{ total() }} DT</h5>
            </div>

            <button
              class="btn btn-primary w-100 btn-lg"
              [disabled]="loading() || checkoutForm.invalid"
              (click)="submitOrder()"
            >
              @if (loading()) {
                <span class="spinner-border spinner-border-sm me-2"></span>
              }
              Confirmer la commande
            </button>

            <a routerLink="/cart" class="btn btn-outline-secondary w-100 mt-2">
              <i class="bi bi-arrow-left"></i> Retour au panier
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<app-footer></app-footer>
