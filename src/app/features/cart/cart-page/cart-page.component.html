<app-navbar></app-navbar>

<main class="py-5">
  <div class="container">
    <h1 class="mb-4">
      <i class="bi bi-cart3"></i> Mon Panier
      @if (itemCount() > 0) {
        <span class="badge bg-primary ms-2">{{ itemCount() }}</span>
      }
    </h1>

    @if (items().length === 0) {
      <!-- Panier vide -->
      <div class="text-center py-5">
        <i class="bi bi-cart-x" style="font-size: 5rem; color: #ccc;"></i>
        <h3 class="mt-3">Votre panier est vide</h3>
        <p class="text-muted">Découvrez nos œuvres d'art et ajoutez-les à votre panier</p>
        <a routerLink="/oeuvres" class="btn btn-primary mt-3">
          <i class="bi bi-search"></i> Parcourir les œuvres
        </a>
      </div>
    } @else {
      <div class="row">
        <!-- Liste des articles -->
        <div class="col-lg-8">
          <div class="card">
            <div class="card-body">
              @for (item of items(); track item.oeuvre.id) {
                <div class="cart-item">
                  <div class="row align-items-center">
                    <!-- Image -->
                    <div class="col-md-2">
                      <img
                        [src]="getImageUrl(item.oeuvre)"
                        [alt]="item.oeuvre.titre"
                        class="img-fluid rounded"
                      >
                    </div>

                    <!-- Infos -->
                    <div class="col-md-4">
                      <h5>{{ item.oeuvre.titre }}</h5>
                      <p class="text-muted mb-0">Par {{ item.oeuvre.artisteNom }}</p>
                      <small class="text-muted">{{ item.oeuvre.categorie }}</small>
                    </div>

                    <!-- Prix unitaire -->
                    <div class="col-md-2 text-center">
                      <strong>{{ item.oeuvre.prix }} DT</strong>
                    </div>

                    <!-- Quantité -->
                    <div class="col-md-2">
                      <div class="input-group input-group-sm">
                        <button
                          class="btn btn-outline-secondary"
                          (click)="updateQuantity(item.oeuvre.id, item.quantity - 1)"
                        >
                          <i class="bi bi-dash"></i>
                        </button>
                        <input
                          type="text"
                          class="form-control text-center"
                          [value]="item.quantity"
                          readonly
                        >
                        <button
                          class="btn btn-outline-secondary"
                          (click)="updateQuantity(item.oeuvre.id, item.quantity + 1)"
                        >
                          <i class="bi bi-plus"></i>
                        </button>
                      </div>
                    </div>

                    <!-- Total -->
                    <div class="col-md-1 text-end">
                      <strong>{{ item.oeuvre.prix * item.quantity }} DT</strong>
                    </div>

                    <!-- Supprimer -->
                    <div class="col-md-1 text-end">
                      <button
                        class="btn btn-sm btn-outline-danger"
                        (click)="removeItem(item.oeuvre.id)"
                      >
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                  <hr>
                </div>
              }

              <div class="text-end mt-3">
                <button class="btn btn-outline-secondary" (click)="clearCart()">
                  <i class="bi bi-trash"></i> Vider le panier
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Résumé -->
        <div class="col-lg-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Résumé de la commande</h5>
              <hr>

              <div class="d-flex justify-content-between mb-2">
                <span>Sous-total ({{ itemCount() }} articles)</span>
                <strong>{{ total() }} DT</strong>
              </div>

              <div class="d-flex justify-content-between mb-2">
                <span>Frais de livraison</span>
                <strong>Gratuit</strong>
              </div>

              <hr>

              <div class="d-flex justify-content-between mb-3">
                <h5>Total</h5>
                <h5 class="text-primary">{{ total() }} DT</h5>
              </div>

              <button
                class="btn btn-primary w-100 btn-lg"
                (click)="goToCheckout()"
              >
                <i class="bi bi-check-circle"></i> Passer la commande
              </button>

              <a routerLink="/oeuvres" class="btn btn-outline-secondary w-100 mt-2">
                <i class="bi bi-arrow-left"></i> Continuer mes achats
              </a>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</main>

<app-footer></app-footer>
